
        if(!editors[this.textContent]){
    editors[this.textContent]=f("editorcopy").cloneNode(true)
    editors[this.textContent].style.height=(window.innerHeight-20)+"px"
    editors[this.textContent].onclick=function(){
        se=this
       

    }
    se=editors[this.textContent];
 
    
    editors[this.textContent].children[1].src=this.link
    editors[this.textContent].loc=this.loc
    
    
    editors[this.textContent].children[0].textContent=sn.textContent+":"+this.textContent
    editors[this.textContent].children[0].dest=sp.n+":"+sn.textContent+":"+this.textContent
    editors[this.textContent].children[0].onmouseover=function(){this.textContent="Clique com o botão direito para fechar"}
    editors[this.textContent].children[0].onmouseout=function(){this.textContent=this.dest}
    editors[this.textContent].children[0].oncontextmenu=function(e){delete editors[this.dest.split(":")[2]];this.parentElement.remove();return false}
    editors[this.textContent].children[0].ondblclick=editors[this.textContent].children[0].oncontextmenu
    editors[this.textContent].children[0].onmousedown=function(e){
        x=e.clientX;y=e.clientY
        document.onmousemove=(e)=>{
            this.style.cursor="grabbing"
            this.parentElement.style.top=(this.parentElement.offsetTop-(y-e.clientY))+"px"
            this.parentElement.style.left=(this.parentElement.offsetLeft-(x-e.clientX))+"px"
            x=e.clientX;y=e.clientY

        }
        document.onmouseup=(w)=>{
            if(w.clientX<0){
                this.oncontextmenu()
            }
            
            console.log(this.parentElement.offsetTop)
            if(this.parentElement.offsetTop<-80){
                window.open(this.parentElement.loc)
                delete editors[this.dest.split(":")[2]];this.parentElement.remove();
            }
            this.style.cursor="grab"
            document.onmousemove=null
            document.onmouseup=null
        }
    }
    
    editors[this.textContent].children[0].ontouchstart=function(e){e.preventDefault()
        x=e.targetTouches[0].pageX;y=e.targetTouches[0].pageY
        document.ontouchmove=(w)=>{
            
            console.log((this.parentElement.offsetLeft-(x-w.targetTouches[0].pageX)))
            if(this.parentElement.offsetWidth+((this.parentElement.offsetLeft-(x-w.targetTouches[0].pageX)))<f("site").offsetWidth){
            this.parentElement.style.top=(this.parentElement.offsetTop-(y-w.targetTouches[0].pageY))+"px"
            this.parentElement.style.left=(this.parentElement.offsetLeft-(x-w.targetTouches[0].pageX))+"px"
            
            x=w.targetTouches[0].pageX;y=w.targetTouches[0].pageY;}
        }
        document.ontouchend=(w)=>{
            if(w.targetTouches[0].pageX<0){
                this.oncontextmenu()
            }
            w.preventDefault()
            document.ontouchend=null;
            document.ontouchmove=null
        }

    }

    f("site").appendChild(editors[this.textContent])

    
        }
}
f("notec").appendChild(nn).style.display=""
}
function noteSearch(e){
  arr=cf("notecopy");for(a in arr){
    if(!arr[a].textContent){return}
    
    
      if(arr[a].textContent.includes(e.value)){arr[a].style.display=""}else{arr[a].style.display="none"}}
}
function ae(e){
    console.log(e.code)
    
    switch(e.code){
        case "auth/invalid-email":{not("red","email invalido, tente denovo!",5000);break};
        case "auth/user-not-found":{not("red","o usuario não existe, tente denovo (ou crie uma conta)!",5000);break};
        case "auth/wrong-password":{not("red","senha errada, cheque a senha, o usuario, e a CapitAlização!",5000);break};
    }

}


function login(){if(!f("mail").checkValidity||f("pass").value.length<3){return}firebase.auth().signInWithEmailAndPassword(f("mail").value, f("pass").value).then((userCredential) => {user=userCredential.user;db.ref("/").set({from:user.uid,get:"home"});document.cookie="pass="+f("pass").value+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/;sameSite=None; Secure";document.cookie="email="+user.email+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/;sameSite=None; Secure";init()}).catch((e)=>{console.log(e.code);ae(e)})}
function createAccount(){firebase.auth().createUserWithEmailAndPassword(f("mail").value, f("pass").value).then((userCredential) => {user=userCredential.user;db.ref("/").set({from:user.uid,get:"home"});document.cookie="pass="+f("pass").value+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/;sameSite=None; Secure";document.cookie="email="+user.email+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/;sameSite=None; Secure";init()}).catch((e)=>{console.log(e.code);ae(e)})}
db.ref("/").on("value",(v)=>{val=v.val()
    console.log(val,anom)
    if(val.anom==anom&&val.from=="server"){
    if(val.get=="sharedPack"){
     createPack(true,true,false,val.destination.split(":")[1])
    }
}
    if(!user){return}
if(val.to==user.uid){
if(val.get=="home"){
    if(!val.content){return}
notes=val.content
packs=Object.keys(notes)

for(i in packs){
    if(val.shared){
        if(val.shared.includes(packs[i])){
            p=true
        }else{
            p=false
        }
    }else{
        p=false
    }
    
    if(packs[i]!="meu"){
        f("packname").value=packs[i]
        
        createPack(true,p,true)
    }


}
fetch("https://api.ipify.org?format=json").then((r)=>{return r.json()}).then((r)=>{db.ref("/").set({get:"visit",ip:r.ip,t:Date.now(),location:window.location.href})})
saved=val.saved
for(i in val.saved){
    f("packname").value=i.split(":")[1]
        
        createPack(true,p,false,i)
}
f("packname").value=""
f("mainpack").n="meu"

}
if(val.get=="noteCreate"){
    if(saved.includes(val.from+":"+val.pack)){
        saved[val.from+":"+val.pack][val.topic].push(val.name)
    }
}


}})
    sp.style.backgroundColor="rgb(0,255,85)"
f("mainpack").onclick=function(){
    
    sp.style.backgroundColor=""
    sp.children[0].style.display="none"
    if(sp.children[1]){
    sp.children[1].style.display="none"}
    f("ctx").textContent="Suas anotações ["+this.n+"]"
    sp=this
    if(this.readOnly){

    }else{
    if(this.children[0]){
        this.children[0].style.display=""
        if(this.children[1]){
            if(this.children[1].p){
                window.history.pushState('x', 'x', '/?'+user.uid+":"+this.n)
            }else{
                window.history.pushState('x', 'x', '/?unshared')
            }
        this.children[1].style.display=""}
    }else{
        window.history.pushState('x', 'x', '/')
    }

}
this.style.backgroundColor="rgb(0,255,85)"
    sn.onclick()
    
    
}
packs=[]
function createPack(s,p,m,n){
    //s - (created by user or code); p - public;m = owned by user;n=name
    //Ignora isso ok toda vez que eu venho aqui eu fico confuso 
    if((!packs.includes(f("packname").value)||s)){
        
        if(!s){
        db.ref("/").set({from:user.uid,get:"packCreate",name:f("packname").value})}
    np=f("mainpack").cloneNode(true);
    
    
    np.id="pack";np.classList.add("imp");np.classList.add("spack");
    if(m){
        np.innerHTML=f("packname").value+"<button style='float:right;background-color:red;display:none'>Deletar</button><button style='float:right;display:none'>compartilhar</button>";
    }else{
        np.innerHTML=f("packname").value+"[modo de leitura]<button style='float:right;background-color:red;display:none'>Deletar</button><button style='float:right;display:none'>compartilhar</button>";
    }
    
    
    np.style.backgroundColor="";np.onclick=f("mainpack").onclick;
    if(m){
    np.n=f("packname").value
    if(p){
    np.children[1].textContent="descompartilhar";np.children[1].p=true}else{
        np.children[1].textContent="compartilhar";np.children[1].p=false
    }
    np.children[1].onclick=function(){this.p=!this.p;if(this.p){this.textContent="descompartilhar"
    this.style.backgroundColor="red"
    db.ref("/").set({get:"sharePack",pack:this.parentElement.n,from:user.uid})

}else{
    this.style.backgroundColor=""
    this.textContent="compartilhar"
    db.ref("/").set({get:"unsharePack",pack:this.parentElement.n,from:user.uid})
}
    }
}else{
    np.n=n
        np.children[0].remove()
        np.readOnly=true
        np.children[0].textContent="esquecer"
        np.children[0].style.backgroundColor="red"
        np.style.backgroundColor="blue"
    }
    f("packs").append(np);
    if(!s){packs.push(f("packname").value)
    notes[f("packname").value]={Outros:[],Hist:[],Port:[],Cie:[],Geo:[],Edf:[],OE:[],Projeto:[],Art:[],Mat:[]}}

}}
function not(color,text,imp,click){nnot=document.createElement("div");nnot.style="animation:not 4s;width:334px;height:66px;position:absolute;bottom:0;right:0;transition:all 1s";nnot.style.backgroundColor=color;nnot.style.opacity="0.4";nnot.style.bottom=nots.length*68+"px";nnot.innerHTML=text;nots.push(f("site").appendChild(nnot));nnot.close=function(){for(i in nots){nots[i].style.bottom=((parseInt(nots[i].style.bottom.slice(0,-2)))-68)+"px"}this.style.right="-334px";setTimeout(()=>{nots.splice(this,1);this.remove()},1000)};nnot.init=function(imp){setTimeout(()=>{this.close()},imp)};nnot.onclick=click;nnot.init(imp)}
not("green","v"+version,4000,function(){})
anom=Math.random().toString(36)
setTimeout(()=>{
    if(loc.href.includes("?")){
    db.ref("/").set({anom,get:"sharedPack",destination:loc.href.split("?")[1]})
}},400)
function init(){
    
    f("loginbar").style="background-image:none;background-color:black";
    f("account").innerHTML="<input id=dn value='"+user.displayName+"'>"
    f("dn").style="width:100%;height:100%;font-size:53px;text-align:center"
    f("account").style="background-color:black";
    f("account").classList.add("li");
    f("dn").onchange=function(){
        console.log(this.value)
        user.updateProfile({displayName:this.value})
    }
    
    
}








//Habilidade: decifrar códigos






</script>
